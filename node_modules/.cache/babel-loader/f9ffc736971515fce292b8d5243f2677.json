{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mattfrawley/sites/srsite/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"/Users/mattfrawley/sites/srsite/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/mattfrawley/sites/srsite/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport { ref } from 'vue';\nimport { db } from '../firebase/config';\nimport { collection, onSnapshot, query, where } from 'firebase/firestore';\n\nvar getOrderDocs = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(c, keyField, fieldValue) {\n    var documents, error, colRef, unsub;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            documents = ref(null);\n            error = ref(null); // register the firestore collection reference\n\n            colRef = collection(db, c);\n\n            if (keyField === 'course') {\n              colRef = query(colRef, where(\"course\", \"==\", fieldValue));\n            } else {\n              colRef = query(colRef, where(\"module\", \"==\", fieldValue));\n            }\n\n            _context.next = 6;\n            return onSnapshot(colRef, function (snap) {\n              var results = [];\n              snap.docs.forEach(function (doc) {\n                // must wait for the server to create the timestamp & send it back\n                results.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                  id: doc.id\n                }));\n              }); // update values\n\n              documents.value = results; // update values\n\n              if (keyField === 'course') {\n                documents.value.sort(function (a, b) {\n                  return a.module > b.module ? 1 : -1;\n                });\n                console.log('here are am with documents: ', documents);\n              } else {\n                documents.value.sort(function (a, b) {\n                  return a.order > b.order ? 1 : -1;\n                });\n              }\n\n              error.value = null;\n            }, function (err) {\n              console.log(err.message); // documents.value = null\n\n              error.value = 'could not fetch the data';\n            });\n\n          case 6:\n            unsub = _context.sent;\n            console.log('and here are documents: ', documents);\n            return _context.abrupt(\"return\", {\n              error: error,\n              documents: documents\n            });\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getOrderDocs(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport default getOrderDocs;","map":{"version":3,"names":["ref","db","collection","onSnapshot","query","where","getOrderDocs","c","keyField","fieldValue","documents","error","colRef","snap","results","docs","forEach","doc","push","data","id","value","sort","a","b","module","console","log","order","err","message","unsub"],"sources":["/Users/mattfrawley/sites/srsite/src/composables/getOrderDocs.js"],"sourcesContent":["import { ref } from 'vue'\nimport { db } from '../firebase/config'\nimport { collection, onSnapshot, query, where } from 'firebase/firestore'\n\nconst getOrderDocs = async(c, keyField, fieldValue) => {\n\n  const documents = ref(null)\n  const error = ref(null)\n\n  // register the firestore collection reference\n  let colRef = collection(db, c)\n  if (keyField==='course'){\n     colRef = query(colRef, where(\"course\", \"==\", fieldValue))\n  } else {\n     colRef = query(colRef, where(\"module\", \"==\", fieldValue))\n  }\n \n    \n  const unsub = await onSnapshot(colRef, snap => {\n    let results = []\n    snap.docs.forEach(doc => {\n      // must wait for the server to create the timestamp & send it back\n      results.push({...doc.data(), id: doc.id})\n    });\n\n    // update values\n    documents.value = results\n    \n    // update values\n    if (keyField==='course') {\n      documents.value.sort((a, b) => (a.module > b.module) ? 1 : -1)\n      console.log('here are am with documents: ', documents)\n    } else {\n      documents.value.sort((a, b) => (a.order > b.order) ? 1 : -1)\n    }\n    \n    \n    error.value = null\n  }, err => {\n    console.log(err.message)\n    // documents.value = null\n    error.value = 'could not fetch the data'\n  })\n  console.log('and here are documents: ', documents)\n  return { error, documents }\n}\n\nexport default getOrderDocs"],"mappings":";;;;;;;AAAA,SAASA,GAAT,QAAoB,KAApB;AACA,SAASC,EAAT,QAAmB,oBAAnB;AACA,SAASC,UAAT,EAAqBC,UAArB,EAAiCC,KAAjC,EAAwCC,KAAxC,QAAqD,oBAArD;;AAEA,IAAMC,YAAY;EAAA,sEAAG,iBAAMC,CAAN,EAASC,QAAT,EAAmBC,UAAnB;IAAA;IAAA;MAAA;QAAA;UAAA;YAEbC,SAFa,GAEDV,GAAG,CAAC,IAAD,CAFF;YAGbW,KAHa,GAGLX,GAAG,CAAC,IAAD,CAHE,EAKnB;;YACIY,MANe,GAMNV,UAAU,CAACD,EAAD,EAAKM,CAAL,CANJ;;YAOnB,IAAIC,QAAQ,KAAG,QAAf,EAAwB;cACrBI,MAAM,GAAGR,KAAK,CAACQ,MAAD,EAASP,KAAK,CAAC,QAAD,EAAW,IAAX,EAAiBI,UAAjB,CAAd,CAAd;YACF,CAFD,MAEO;cACJG,MAAM,GAAGR,KAAK,CAACQ,MAAD,EAASP,KAAK,CAAC,QAAD,EAAW,IAAX,EAAiBI,UAAjB,CAAd,CAAd;YACF;;YAXkB;YAAA,OAcCN,UAAU,CAACS,MAAD,EAAS,UAAAC,IAAI,EAAI;cAC7C,IAAIC,OAAO,GAAG,EAAd;cACAD,IAAI,CAACE,IAAL,CAAUC,OAAV,CAAkB,UAAAC,GAAG,EAAI;gBACvB;gBACAH,OAAO,CAACI,IAAR,iCAAiBD,GAAG,CAACE,IAAJ,EAAjB;kBAA6BC,EAAE,EAAEH,GAAG,CAACG;gBAArC;cACD,CAHD,EAF6C,CAO7C;;cACAV,SAAS,CAACW,KAAV,GAAkBP,OAAlB,CAR6C,CAU7C;;cACA,IAAIN,QAAQ,KAAG,QAAf,EAAyB;gBACvBE,SAAS,CAACW,KAAV,CAAgBC,IAAhB,CAAqB,UAACC,CAAD,EAAIC,CAAJ;kBAAA,OAAWD,CAAC,CAACE,MAAF,GAAWD,CAAC,CAACC,MAAd,GAAwB,CAAxB,GAA4B,CAAC,CAAvC;gBAAA,CAArB;gBACAC,OAAO,CAACC,GAAR,CAAY,8BAAZ,EAA4CjB,SAA5C;cACD,CAHD,MAGO;gBACLA,SAAS,CAACW,KAAV,CAAgBC,IAAhB,CAAqB,UAACC,CAAD,EAAIC,CAAJ;kBAAA,OAAWD,CAAC,CAACK,KAAF,GAAUJ,CAAC,CAACI,KAAb,GAAsB,CAAtB,GAA0B,CAAC,CAArC;gBAAA,CAArB;cACD;;cAGDjB,KAAK,CAACU,KAAN,GAAc,IAAd;YACD,CApB6B,EAoB3B,UAAAQ,GAAG,EAAI;cACRH,OAAO,CAACC,GAAR,CAAYE,GAAG,CAACC,OAAhB,EADQ,CAER;;cACAnB,KAAK,CAACU,KAAN,GAAc,0BAAd;YACD,CAxB6B,CAdX;;UAAA;YAcbU,KAda;YAuCnBL,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCjB,SAAxC;YAvCmB,iCAwCZ;cAAEC,KAAK,EAALA,KAAF;cAASD,SAAS,EAATA;YAAT,CAxCY;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAH;;EAAA,gBAAZJ,YAAY;IAAA;EAAA;AAAA,GAAlB;;AA2CA,eAAeA,YAAf"},"metadata":{},"sourceType":"module"}